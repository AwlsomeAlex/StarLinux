################################
#------------------------------#
# StarBuilder Function Library #
#------------------------------#
################################
# Made by AwlsomeAlex [GPLv3]  #
#       Version: 0.0.4a        #
################################


#############################
#                           #
# StarBuilder Configuration #
#                           #
#############################


###############
# Source List #
###############
LINUX_URL=http://kernel.org/pub/linux/kernel/v4.x/linux-4.9.13.tar.xz
GLIBC_URL=http://ftp.gnu.org/gnu/glibc/glibc-2.25.tar.bz2
BUSYBOX_URL=http://busybox.net/downloads/busybox-1.26.2.tar.bz2
SYSLINUX_URL=http://kernel.org/pub/linux/utils/boot/syslinux/syslinux-6.03.tar.xz


################
# Archive List #
################
LINUX_ARCHIVE=${LINUX_URL##*/}
GLIBC_ARCHIVE=${GLIBC_URL##*/}
BUSYBOX_ARCHIVE=${BUSYBOX_URL##*/}
SYSLINUX_ARCHIVE=${SYSLINUX_URL##*/}


#########################
# StarBuilder Variables #
#########################
WORK_DIR=/tmp/starbuilder
IMAGE_DIR=/home/$USER/Desktop # Set User Directory
JOB_FACTOR=1
NUM_CORES=$(grep ^processor /proc/cpuinfo | wc -l)
NUM_JOBS=$((NUM_CORES * JOB_FACTOR))
VERSION=0.0.2


###############
# Color Codes #
###############
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'


#########################
#                       #
# StarBuilder Functions #
#                       #
#########################


##############################
# Update StarBuilder Library # update_library
##############################
function update_library (){
	wget https://raw.githubusercontent.com/AwlsomeAlex/StarLinux/master/version.txt
	STAR_VER_NEW=$(cat version.txt)
	if [ $VERSION == $STAR_VER_NEW ]; then
		echo "StarBuilder is up-to-date."
		menu
	else
		echo "StarBuilder has to be updated."
		rm -rf version.txt
		rm -rf /tmp/starver.txt
		exit 0
		# More Functionality (Like Library Updating) will be added at another time.
	fi
}


##########################
# Check Library Function # check_lib
##########################
function check_lib (){
CHECK="StarBuilder Library Fully Functional." 
}


##########################
# Delete Temporary Files # deltempfile
##########################
function deltempfile (){
    rm -r /tmp/menuchoice.$$
}


###################
# Master Function # master
###################
function master (){
	update_library
	menu
}


#################
# Menu Function # menu
#################
function menu (){
    
    trap 'deltempfile'  EXIT # Calls 'deltemp' on exit.
    
    while :
    do
    
        dialog --clear --backtitle "StarBuilder (StarLinux Builder)" --title "Main Menu:" \
        --menu "Please Select an Option using the [UP/DOWN] keys." 15 95 6 \
        "COMPILE_STARLINUX"     "Compile Core StarLinux Componients including Filesystem, Kernel, etc." \
        "LOAD_OVERLAYS"         "Load Additional Overlay Libraries to be compiled into StarLinux." \
        "BUILD_IMAGE"           "Package StarLinux and Additional Overlays into a Disk Image." \
        "PACKAGE_SOURCE"        "Package StarLinux and Additional Overlays into an TAR Archive." \
        "ABOUT"                 "Shows License and Additional Information of StarLinux and StarBuilder." \
        "EXIT"                  "Exit StarBuilder and Delete Temporary Files" 2> /tmp/menuchoice.$$
        
        retopt=$?
        choice=`cat /tmp/menuchoice.$$`
        
        case $retopt in
        
            0) case $choice in
            
                    COMPILE_STARLINUX)      compile_starlinux ;;
                    LOAD_OVERLAYS)          load_overlays ;;
                    BUILD_IMAGE)            build_image ;;
                    PACKAGE_SOURCE)         package_source ;;
                    ABOUT)                  about ;;
                    EXIT)                   clear ; exit 0 ;;
            
                esac ;;
        
            *)clear ; exit ;;
    esac
    
done
}


#####################
#                   #
# Compile StarLinux # compile_starlinux
#                   #
#####################
function compile_starlinux (){
    echo "Compile StarLinux"
    exit 1
}


#################
#               #
# Load Overlays # load_overlays
#               #
#################
function load_overlays (){
    echo "Load Overlays"
    exit 1
}


###############
#             #
# Build Image # build_image
#             #
###############
function build_image (){
    echo "Build Image"
    exit 1
}


##################
#                #
# Package Source # package_source
#                #
##################
function package_source (){
    echo "Package Source"
    exit 1
}


################
#              #
# About Dialog # about
#              #
################
function about (){
    echo "About Dialog"
    exit 1
}
