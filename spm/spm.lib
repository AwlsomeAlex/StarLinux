################################
#                              #
# Star Package Manager Library #
#                              #
################################
# Created by AwlsomeAlex [GPLv3]
# Compatible with StarOS & Star Library

SPML_VER="GIT-20180209-001"




# Download a File [-s will silently download]
download() {
	FILE=$1
	TICKER=$2
	if [[ $FILE == "StarOS" ]]; then
		wget https://github.com/AwlsomeAlex/StarLinux/archive/StarOS.zip -q --show-progress
	else
		if [[ $TICKER == "-s" ]]; then
			wget $FILE -q
		else
			wget $FILE -q --show-progress
		fi
	fi
}

# Install a Required Program to Host System
install_required() {
	PACKAGE=$1
	check_distro
	if [[ $OS == "Ubuntu" ]]; then
		sudo apt install $PACKAGE
	else
		echo "Unknown or Unsupported Distribution detected. Please report for support and install the package $PACKAGE manually."
	fi
}

# Title for Star Package Manager 
title() {
	clear
	echo "========================"
	echo "|                      |"
	echo "| Star Package Manager |"
	echo "|----------------------|"
	echo "|    By AwlsomeAlex    |"
	echo "|      GNU GPLv3*      |"
	echo "========================"
	echo " Version: $SPM_VER "
	echo " Function: $FUNCTION "
	echo ""	
}

# Check Host Operating System Distribution
check_distro() {
	if [ -f /etc/os-release ]; then
		. /etc/os-release
		OS=$NAME
	elif type lsb_release >/dev/null 2>&1; then
		OS=$(lsb_release -si)
	elif [ -f /etc/lsb_release ]; then
		. /etc/lsb_release
		OS=$DISTRIB_ID
	elif [ -f /etc/debian_version ]; then
		OS=Debian
	elif [ -f /etc/SuSe-release ]; then
		OS=Suse
	elif [ -f /etc/redhat-release ]; then
		OS=Redhat
	else
		OS=$(uname -s)
	fi
}

# Reassure User Library is Loaded.
assurance() {
	echo "-----------------------------------------------"
	echo " Star Package Manager Library $SPML_VER Loaded."
	echo "-----------------------------------------------"
}

# Update Repository to Latest GIT (Temporary)
update_repo() {
	if [[ $NATIVE == "True" ]]; then
		ORIGIN=$(pwd)
		cd /tmp
		download https://raw.githubusercontent.com/AwlsomeAlex/StarLinux/StarOS/spm/version.txt
		diff /etc/spm/version.txt /tmp/version.txt >/dev/null 2>&1 || UPDATE=Y
		if [[ $UPDATE == "Y" ]]; then
			download StarOS #Temporary GIT
			unzip StarOS.zip #Temporary GIT
			cd StarOS/spm
			sudo cp -r repo /etc/spm/repo #Untested
			cd /tmp
			rm -rf StarOS.zip StarOS/
		fi
		rm -rf version.txt
		cd $ORIGIN
	else
		if [ -d /tmp/spm ]; then
			rm -rf /tmp/spm
		fi
		mkdir /tmp/spm
		cd /tmp/spm
		download StarOS
		unzip -q StarOS 
		cd StarLinux-StarOS/spm/repo
		if [[ $(cat version.txt) == $SPM_VER ]]; then
			echo "$SPM_VER Repository Downloaded."
		else
			echo "The GIT Repository is behind. Please Try Again Later. :("
			exit 0
		fi
		REPO_DIR=$(pwd) ## Save this for later. ;)
	fi
}
